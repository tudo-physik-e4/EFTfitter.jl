<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Tutorial · EFTfitter.jl</title><link rel="canonical" href="https://github.com/tudo-physik-e4/EFTfitter.jl/tutorial/"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">EFTfitter.jl</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../installation/">Installation</a></li><li class="is-active"><a class="tocitem" href>Tutorial</a><ul class="internal"><li><a class="tocitem" href="#File-&quot;tutorial_inputs.jl&quot;-1"><span>File &quot;tutorial_inputs.jl&quot;</span></a></li><li><a class="tocitem" href="#File-&quot;runTutorial.jl&quot;-1"><span>File &quot;runTutorial.jl&quot;</span></a></li></ul></li><li><a class="tocitem" href="../advanced_tutorial/">Advanced Tutorial</a></li><li><a class="tocitem" href="../BLUE/">BLUE Example</a></li><li><a class="tocitem" href="../plotting/">Plotting</a></li><li><a class="tocitem" href="../api/">API</a></li><li><a class="tocitem" href="../LICENSE/">LICENSE</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Tutorial</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Tutorial</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/tudo-physik-e4/EFTfitter.jl/blob/master/docs/src/tutorial.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="EFTfitter.jl-Tutorial-1"><a class="docs-heading-anchor" href="#EFTfitter.jl-Tutorial-1">EFTfitter.jl - Tutorial</a><a class="docs-heading-anchor-permalink" href="#EFTfitter.jl-Tutorial-1" title="Permalink"></a></h1><p>Table of contents:</p><ul><li><a href="#EFTfitter.jl-Tutorial-1">EFTfitter.jl - Tutorial</a></li><ul><li><a href="#File-&quot;tutorial_inputs.jl&quot;-1">File &quot;tutorial_inputs.jl&quot;</a></li><ul><li><a href="#Parameters-1">Parameters</a></li><li><a href="#Observables-1">Observables</a></li><li><a href="#Measurements-1">Measurements</a></li><li><a href="#Correlations-1">Correlations</a></li></ul><li><a href="#File-&quot;runTutorial.jl&quot;-1">File &quot;runTutorial.jl&quot;</a></li></ul></ul><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>An executable version of this tutorial can be found <a href="https://github.com/tudo-physik-e4/EFTfitter.jl/tree/main/examples/tutorial">here</a>. A template to help starting your own analysis is available <a href="https://github.com/tudo-physik-e4/EFTfitter.jl/tree/master/examples/empty_template">here</a>.</p></div></div><hr/><p>It is recommended to store the inputs (i.e. parameters, observables, measurements and correlations) and the actual analysis in two separate files. This allows to simply load different configurations of the model. We will therefore also consider two files: <code>tutorial_inputs.jl</code> and <code>runTutorial.jl</code>.</p><h2 id="File-&quot;tutorial_inputs.jl&quot;-1"><a class="docs-heading-anchor" href="#File-&quot;tutorial_inputs.jl&quot;-1">File &quot;tutorial_inputs.jl&quot;</a><a class="docs-heading-anchor-permalink" href="#File-&quot;tutorial_inputs.jl&quot;-1" title="Permalink"></a></h2><p>We start by defining all neccesary inputs to create an <a href="https://tudo-physik-e4.github.io/EFTfitter.jl/dev/api/#EFTfitter.EFTfitterModel"><code>EFTfitterModel</code></a>.</p><h3 id="Parameters-1"><a class="docs-heading-anchor" href="#Parameters-1">Parameters</a><a class="docs-heading-anchor-permalink" href="#Parameters-1" title="Permalink"></a></h3><p>We specify the parameters our model depends on and choose a prior for each of the parameters. The prior has to be specified in form of a <a href="https://bat.github.io/BAT.jl/dev/tutorial/#Prior-Definition">BAT.jl prior</a>.</p><p>For our example, we consider two parameters with the names <code>C1</code> and <code>C2</code>. For <code>C1</code> we choose a uniform (flat) prior in the range (-3, 3). For <code>C2</code> we choose a gaussian prior with μ=0 and σ=0.5.</p><pre><code class="language-julia">parameters = BAT.NamedTupleDist(
    C1 = -3..3, # short for: Uniform(-3, 3)
    C2 = Normal(0, 0.5) # Normal distribution
)</code></pre><p>A parameter can be fixed (and therefore excluded from the fit) by setting its prior to a certain value, e.g.: <code>C2 = 0</code>. Also see <a href="https://bat.github.io/BAT.jl/dev/tutorial/#Prior-Definition">here</a> for more information on priors in the BAT.jl documentation.</p><h3 id="Observables-1"><a class="docs-heading-anchor" href="#Observables-1">Observables</a><a class="docs-heading-anchor-permalink" href="#Observables-1" title="Permalink"></a></h3><p>We now proceed to implement <code>Functions</code> that specify how the predicted values of the observables depend on the model parameters. For each observable, we need to provide a <code>Function</code> that returns the predicted value of the observable for certain values of the model parameters. In our example, we consider two observables (e.g. cross sections) by defining the two functions <code>xsec1</code> and <code>xsec2</code>.</p><p>Note: The functions for the observables may only have the model parameters as their only argument. You can, however define a function that only depends on the parameters and that internally calls a more complex function and passes the corresponding arguments. In this example, the function <code>xsec2</code> calls the function <code>myfunc</code> and passes further arguments (<code>coeffs</code>).</p><pre><code class="language-julia">function xsec1(params)
    c = [20.12, 5.56, 325.556]
    return c[1] * params.C1 + c[2] * params.C1 * params.C2+ c[3] * params.C2
end

function xsec2(params)
    coeffs = [2.12, 4.3, 12.6]
    return myfunc(params, coeffs)
end

function myfunc(params, c)
    return c[1] * params.C1 + c[2] * params.C1 * params.C2+ c[3] * params.C2
end</code></pre><p>If your observable is a distribution, you can define a vector of functions with one function for each bin of the distribution. (You could also treat each bin as a separate observable as shown above.)</p><pre><code class="language-julia">function diff_xsec_bin1(params)
    coeffs = [2.2, 5.5, 6.6]
    return myfunc(params, coeffs)
end

function diff_xsec_bin2(params)
    coeffs = [3.3, 4.8, 7.6]
    return myfunc(params, coeffs)
end

function diff_xsec_bin3(params)
    coeffs = [4.9, 5.6, 8.9]
    return myfunc(params, coeffs)
end

diff_xsec = [diff_xsec_bin1, diff_xsec_bin2, diff_xsec_bin3]</code></pre><p>Note: Another way to define a vector of functions for the bins of distributions is shown <a href="https://tudo-physik-e4.github.io/EFTfitter.jl/dev/advanced_tutorial/#Creating-a-vector-of-functions-for-distributions-1">here</a> in the <a href="https://tudo-physik-e4.github.io/EFTfitter.jl/dev/advanced_tutorial/">advanced tutorial</a>. This can be particularly useful when the predictions for the individual bins have a similar functional relation and only differ in terms of some coefficients, as it is the case here in this example.</p><h3 id="Measurements-1"><a class="docs-heading-anchor" href="#Measurements-1">Measurements</a><a class="docs-heading-anchor-permalink" href="#Measurements-1" title="Permalink"></a></h3><p>We can now enter measurements of the observables. This is done by defining a <a href="https://docs.julialang.org/en/v1/manual/types/#Named-Tuple-Types"><code>NamedTuple</code></a> consisting of <a href="https://tudo-physik-e4.github.io/EFTfitter.jl/dev/api/#EFTfitter.Measurement"><code>Measurement</code></a> and <a href="https://tudo-physik-e4.github.io/EFTfitter.jl/dev/api/#EFTfitter.MeasurementDistribution"><code>MeasurementDistribution</code></a> objects.</p><p>A <code>Measurement</code> consists of the observable, the measured numerical value and numerical values for the (multiple types of) uncertainties. The observable can be passed to the <code>Measurement</code> either as an <a href="https://tudo-physik-e4.github.io/EFTfitter.jl/dev/api/#EFTfitter.Observable"><code>Observable</code></a> object or as a <code>Function</code>. When using the latter, the observable is assumed to be unconstrained. The uncertainties are passed as a <a href="https://docs.julialang.org/en/v1/manual/types/#Named-Tuple-Types"><code>NamedTuple</code></a>. Each measurement has to provide uncertainty values for all of the (active) uncertainty types (see next section on <code>Correlations</code>). For a <code>MeasurementDistribution</code>, the corresponding inputs have to be passed as <code>Vectors</code>, where each element represents one bin of the distribution.</p><p>A <code>Measurement</code> can be excluded from the model by setting the switch <code>active=false</code>. For a <code>MeasurementDistribution</code>, the keyword <code>active</code> accepts <code>true</code> or <code>false</code> to (de)activate the whole distribution or a vector of booleans for (de)activating only certain bins.</p><pre><code class="language-julia">measurements = (
    Meas1 = Measurement(xsec1, 21.6, uncertainties = (stat=0.8, syst=1.8, another_unc=2.3),
            active=true), # `active = false`: exclude measurement from fit (default: active = true)

    Meas2 = Measurement(Observable(xsec2, min=0), 1.9,
            uncertainties = (stat=0.6, syst=0.9, another_unc=1.1), active=true),

    MeasDist = MeasurementDistribution(diff_xsec, [1.9, 2.93, 4.4],
               uncertainties = (stat = [0.7, 1.1, 1.2], syst= [0.7, 0.8, 1.3], another_unc = [1.0, 1.2, 1.9]),
               active=[true, false, true]), # `active = false`: exclude all bins from fit, `active = [true, true, false]`: exclude only third bin from fit
)</code></pre><p>Further information on the constructors see the API documentation of <a href="https://tudo-physik-e4.github.io/EFTfitter.jl/dev/api/#EFTfitter.Measurement"><code>Measurement</code></a> and <a href="https://tudo-physik-e4.github.io/EFTfitter.jl/dev/api/#EFTfitter.MeasurementDistribution"><code>MeasurementDistribution</code></a>.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>When using only one measurement or only one type of uncertainties, make sure to insert a comma, like: <code>uncertainties = (stat = 0.5,)</code> so that Julia can parse the <a href="https://docs.julialang.org/en/v1/manual/types/#Named-Tuple-Types"><code>NamedTuple</code></a> correctly!</p></div></div><h3 id="Correlations-1"><a class="docs-heading-anchor" href="#Correlations-1">Correlations</a><a class="docs-heading-anchor-permalink" href="#Correlations-1" title="Permalink"></a></h3><p>The correlations between the uncertainties of the measurements need to be provided for each of the uncertainty types. We can pass them by defining a <code>NamedTuple</code> of <a href="https://tudo-physik-e4.github.io/EFTfitter.jl/dev/api/#EFTfitter.Correlation"><code>Correlation</code></a> objects that contain the corresponding correlation matrices. The correlation matrix for each type of uncertainty needs to have a size of <span>$N \times N$</span>, where <span>$N$</span> is the number of measurements, counting each bin of a distribution. When a certain type of uncertainty should not be considered, it can be deactivated by setting <code>active = false</code>. This means that the uncertainty values given in the corresponding <code>Measurement</code> and <code>MeasurementDistribution</code> objects will not be used.</p><p>When assuming the uncertainties of all measurements are uncorrelated, you can use the <code>NoCorrelation</code> object for easily passing an identity matrix of the correct size.</p><p>When using a large number of measurements, entering the correlation matrix becomes quite impractical, especially if you want to add further measurements later. With the function <code>to_correlation_matrix</code>, it is possible to enter a correlation matrix by simply specifying the names of the measurements that should be correlated and the value of the corresponding correlation coefficient. When using a <code>MeasurementDistribution</code>, the inter-bin correlations can also be entered by passing a matrix. By appending <code>_binX</code> to the name of a <code>MeasurementDistribution</code>, the Xth bin of the distribution can be accessed. Note: This function is evaluated from top to bottom, so if you overwrite a specific correlation value, the last value entered will be used.</p><pre><code class="language-julia">dist_corr = [1.0 0.5 0.0;
             0.5 1.0 0.0;
             0.0 0.0 1.0]

another_corr_matrix = to_correlation_matrix(measurements,
    (:Meas1, :Meas2, 0.4), # correlate measurements :Meas1 and :Meas2 with a correlation coefficient of 0.4
    (:Meas1, :MeasDist, 0.1), # correlate all bins of :MeasDist with :Meas1 with 0.1
    (:MeasDist, :MeasDist, dist_corr), # correlate the bins of :MeasDist according to the matrix dist_corr
    (:MeasDist_bin2, :MeasDist_bin3, 0.3), # correlate bin2 of :MeasDist with bin3 with 0.3 (overwrites the corresponding element set in the previous line, but ignored in fit since MeasDist_bin2 is inactive)
)</code></pre><pre><code class="language-julia">correlations = (
    stat = NoCorrelation(active=true), # will use the identity matrix of the correct size

    syst = Correlation([1.0 0.5 0.3 0.2 0.2;
                        0.5 1.0 0.2 0.2 0.2;
                        0.3 0.2 1.0 0.2 0.2;
                        0.2 0.2 0.2 1.0 0.2;
                        0.2 0.2 0.2 0.2 1.0], active=false), # `active = false`: ignore all uncertainty values and correlations for this type of uncertainty

    another_unc = Correlation(another_corr_matrix, active=true)
)</code></pre><h2 id="File-&quot;runTutorial.jl&quot;-1"><a class="docs-heading-anchor" href="#File-&quot;runTutorial.jl&quot;-1">File &quot;runTutorial.jl&quot;</a><a class="docs-heading-anchor-permalink" href="#File-&quot;runTutorial.jl&quot;-1" title="Permalink"></a></h2><p>Here, we create the <code>EFTfitterModel</code> from our inputs and run the actual analysis.</p><p>First, we need to setup EFTfitter, BAT and some other Julia packages:</p><pre><code class="language-julia">using EFTfitter
using BAT            # for sampling
using IntervalSets   # for specifying the prior
using Distributions  # for specifying the prior
using Plots # for plotting</code></pre><p>We can then build the <code>EFTfitterModel</code> which combines all our inputs into one object that is then used to perform the analysis on.</p><pre><code class="language-julia">model = EFTfitterModel(parameters, measurements, correlations)</code></pre><p>To sample the posterior distribution, we specify that our <code>EFTfitterModel</code> should be used and then setup BAT.jl to sample the EFTfitter likelihood.</p><pre><code class="language-julia">posterior = PosteriorDensity(model)

algorithm = MCMCSampling(mcalg = MetropolisHastings(), nsteps = 10^5, nchains = 4)
samples = bat_sample(posterior, algorithm).result;</code></pre><p>For further information on settings &amp; algorithms when sampling with BAT.jl see the BAT.jl <a href="https://bat.github.io/BAT.jl/dev/tutorial/#Parameter-Space-Exploration-via-MCMC">tutorial</a> and <a href="https://bat.github.io/BAT.jl/dev/stable_api/#BAT.bat_sample">documentation</a>.</p><p>We can then inspect the results of the sampling using BAT.jl&#39;s <code>SampledDensity</code>, giving a summary of the sampling and the results of the model parameters.</p><pre><code class="language-julia">sd = SampledDensity(posterior, samples)
display(sd)</code></pre><pre><code class="language-none">BAT.jl - SampledDensity
──────────────────────────────

Sampling:
─────────────────────────
total number of samples:      103343
effective number of samples: (C1 = 19897.99484950266, C2 = 18106.884734831812)


Parameter estimates:
─────────────────────────
number of free parameters: 2

Table with 5 columns and 2 rows:
     parameter  mean       std        global_mode  marginal_mode
   ┌────────────────────────────────────────────────────────────
 1 │ C1         0.864514   0.349673   0.821192     0.81
 2 │ C2         0.0129843  0.0210368  0.0155112    0.0165


Covariance matrix:
─────────────────────────
2×2 Named Array{Float64,2}
cov ╲  │          C1           C2
───────┼─────────────────────────
C1     │    0.122271   -0.0070394
C2     │  -0.0070394  0.000442548</code></pre><p>Information about the smallest 1d intervals containing p% proability can be obtained using the <code>get_smallest_interval_edges</code> function:</p><pre><code class="language-julia">intervals_1d_C1 = get_smallest_interval_edges(samples, :C1, 0.9, bins=200, atol=0.1)
println(&quot;lower interval edges: $(intervals_1d_C1.lower)&quot;)
println(&quot;upper interval edges: $(intervals_1d_C1.upper)&quot;)</code></pre><p>The keyword <code>atol</code> controls the absolute tolerance for which intervals are joined together when they are seperated less than this value. This is particularly useful when a large number of bins is used.</p><p>Of course, plotting the resulting posterior distributions is also simple using Plots.jl and the BAT.jl plotting recipes:</p><pre><code class="language-julia">p = plot(samples)
savefig(p, &quot;plot.pdf&quot;)</code></pre><p><img src="../plots/plot.png" alt="example plot"/></p><p>For information on how to customize plots of the samples, please see the BAT.jl <a href="https://bat.github.io/BAT.jl/dev/plotting/">plotting documentation</a> and <a href="https://github.com/bat/BAT.jl/blob/master/examples/dev-internal/plotting_examples.jl">examples</a>.</p><pre><code class="language-julia">p = plot(samples, 0.9)
savefig(p, &quot;plot_1d.pdf&quot;)</code></pre><p><img src="../plots/interval_plot_1.png" alt="example plot"/></p><p>For customizing the plots of the 1D intervals, also see the EFTfitter <a href="https://tudo-physik-e4.github.io/EFTfitter.jl/dev/plotting/">plotting documentation</a> and <a href="https://github.com/tudo-physik-e4/EFTfitter.jl/blob/main/examples/tutorial/plotting.jl">tutorial</a>.</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../installation/">« Installation</a><a class="docs-footer-nextpage" href="../advanced_tutorial/">Advanced Tutorial »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 10 May 2021 00:38">Monday 10 May 2021</span>. Using Julia version 1.6.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
